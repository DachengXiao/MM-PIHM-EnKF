#include "pihm.h"

realtype monthly_lai (realtype t, int LC_type)
{
    time_t         *rawtime;
    struct tm      *timestamp;

    realtype        lai_tbl[20][12] = {
                    {8.760, 9.160, 9.827, 10.09, 10.36, 10.76, 10.49, 10.23, 10.09, 9.827, 9.160, 8.760},
                    {5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117, 5.117},
                    {8.760, 9.160, 9.827, 10.09, 10.36, 10.76, 10.49, 10.23, 10.09, 9.827, 9.160, 8.760},
                    {0.520, 0.520, 0.867, 2.107, 4.507, 6.773, 7.173, 6.507, 5.040, 2.173, 0.867, 0.520},
                    {4.640, 4.840, 5.347, 6.100, 7.434, 8.767, 8.833, 8.367, 7.567, 6.000, 5.014, 4.640},
                    {0.581, 0.629, 0.629, 0.629, 0.919, 1.769, 2.551, 2.554, 1.729, 0.970, 0.726, 0.629},
                    {0.400, 0.404, 0.314, 0.223, 0.250, 0.330, 0.432, 0.800, 1.167, 0.798, 0.504, 0.404},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.782, 0.893, 1.004, 1.116, 1.782, 3.671, 4.782, 4.227, 2.004, 1.227, 1.004, 0.893},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.782, 0.893, 1.004, 1.116, 1.782, 3.671, 4.782, 4.227, 2.004, 1.227, 1.004, 0.893},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001},
                    {0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0}};

    rawtime = (time_t *) malloc (sizeof (time_t));
    *rawtime = (int) t;
    timestamp = gmtime (rawtime);
    free (rawtime);

    return (lai_tbl[LC_type - 1][timestamp->tm_mon]);
}

realtype monthly_rl (realtype t, int LC_type)
{
    time_t         *rawtime;
    struct tm      *timestamp;

    realtype        rl_tbl[20][12] = {
                    {1.112, 1.103, 1.088, 1.082, 1.076, 1.068, 1.073, 1.079, 1.082, 1.088, 1.103, 1.112},
                    {2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653, 2.653},
                    {1.112, 1.103, 1.088, 1.082, 1.076, 1.068, 1.073, 1.079, 1.082, 1.088, 1.103, 1.112},
                    {0.520, 0.520, 0.666, 0.910, 1.031, 1.044, 1.042, 1.037, 1.036, 0.917, 0.666, 0.520},
                    {0.816, 0.812, 0.877, 0.996, 1.054, 1.056, 1.058, 1.058, 1.059, 1.003, 0.885, 0.816},
                    {0.056, 0.056, 0.056, 0.054, 0.054, 0.054, 0.054, 0.057, 0.059, 0.058, 0.057, 0.056},
                    {0.037, 0.037, 0.035, 0.033, 0.033, 0.033, 0.033, 0.039, 0.041, 0.040, 0.038, 0.037},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.078, 0.078, 0.078, 0.078, 0.078, 0.077, 0.076, 0.077, 0.078, 0.078, 0.078, 0.078},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.078, 0.078, 0.078, 0.078, 0.078, 0.077, 0.076, 0.077, 0.078, 0.078, 0.078, 0.078},
                    {0.195, 0.194, 0.208, 0.233, 0.246, 0.246, 0.245, 0.246, 0.247, 0.235, 0.210, 0.195},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {0.078, 0.078, 0.078, 0.078, 0.078, 0.077, 0.076, 0.077, 0.078, 0.078, 0.078, 0.078},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0},
                    {999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0, 999.0}};

    rawtime = (time_t *) malloc (sizeof (time_t));
    *rawtime = (int) t;
    timestamp = gmtime (rawtime);
    free (rawtime);

    return (rl_tbl[LC_type - 1][timestamp->tm_mon]);
}

realtype monthly_mf (realtype t)
{
    time_t         *rawtime;
    struct tm      *timestamp;

    realtype        mf_tbl[12] = { 0.001308019, 0.001633298, 0.002131198, 0.002632776, 0.003031171, 0.003197325, 0.003095839, 0.002745240, 0.002260213, 0.001759481, 0.001373646, 0.001202083};

    rawtime = (time_t *) malloc (sizeof (time_t));
    *rawtime = (int) t;
    timestamp = gmtime (rawtime);
    free (rawtime);

    return (mf_tbl[timestamp->tm_mon]);
}

realtype Interpolation (TSD *Data, realtype t)
{
    int             i;
    int             success;
    realtype        result;

    //i = Data->iCounter;
    i = 0;
    success = 0;

    while (i < Data->length && t > Data->TS[i][0])
        i++;
    if (i == 0)
    {
        /* t is smaller than the 1st node */
        result = Data->TS[i][1];
    }
    else if (i >= Data->length)
    {
        result = Data->TS[i - 1][1];
    }
    else
    {
        result = ((Data->TS[i][0] - t) * Data->TS[i - 1][1] + (t - Data->TS[i - 1][0]) * Data->TS[i][1]) / (Data->TS[i][0] - Data->TS[i - 1][0]);
        success = 1;
    }
    if (success == 0)
    {
        /*
         * printf("\nWarning:  Extrapolation is used ...\n");
         */
    }
    return result;
}

void MultiInterpolation (TSD *Data, realtype t, realtype *forcing, int num_forcing)
{
    int             i;
    int             success;
    int             j;

    //i = Data->iCounter;
    i = 0;
    success = 0;

    while (i < Data->length && t > Data->TS[i][0])
        i++;
    if (i == 0)
    {
        /* t is smaller than the 1st node */
        for (j = 0; j < num_forcing; j++)
            forcing[j] = Data->TS[i][j + 1];
    }
    else if (i >= Data->length)
    {
        for (j = 0; j < num_forcing; j++)
            forcing[j] = Data->TS[i-1][j + 1];
    }
    else
    {
        for (j = 0; j < num_forcing; j++)
            forcing[j] = ((Data->TS[i][0] - t) * Data->TS[i - 1][j + 1] + (t - Data->TS[i - 1][0]) * Data->TS[i][j + 1]) / (Data->TS[i][0] - Data->TS[i - 1][0]);
        success = 1;
    }
    if (success == 0)
    {
        /*
         * printf("\nWarning:  Extrapolation is used ...\n");
         */
    }
}

